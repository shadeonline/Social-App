{% extends 'base.html' %}
{% load mathfilters %}
{% block content %}
{% if profile %}
<div class="container">

    <div class="row">

        <div class="col-10">
            <div class="jumbotron">
                <h1 class="display-4">{{profile.user.username}}'s Profile</h1>
                <p class="lead"></p>
                <hr class="my-4">
                <p>{{profile.intro}}</p>
            </div>

            <br>
            <br>


            {% if posts %}
            {% for post in posts %}
            <div class="card" style="width: 90%;">
                <img src="../images/{{post.image}}" class="card-img-top" alt="...">
                <div class="card-body">

                    <p class="card-text">{{post.description}}</p>
                    <small class="text-muted">
                        <a href="{% url 'profile' post.user.id %}">@{{ post.user.username }}</a> |
                        {{ post.created_at }}
                    </small>
                </div>
            </div>
            <br>
            {% endfor %}
            {% endif %}


        </div>



        <div class="col-2 text-center">
            {% if profile.user.id == user.profile.user_id %}
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Edit Profile
            </button>

                <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Edit Profile</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <form action="{% url 'profile_update' profile.user.id %}" method="post"
                            enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="modal-body">
                                <div class="form-group">
                                    <textarea class="form-control" id="intro" name="intro"
                                    placeholder="Write your introduction here."
                                        rows="3">{{ profile.intro }}</textarea>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                    data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            {% else %}

            <a href="{% url 'chatroom' user.profile.user_id|mul:profile.user.id profile.user.id %} " class="btn btn-primary btn-lg">Chat</a>
            {% endif %}

            <br>
            <br>
        
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Following</h5>
                    {% for following in profile.follows.all %}
                    {% if following.user.id != profile.user.id %}
                    <a href="{% url 'profile' following.user.id %} " class="card-link">@{{following}}</a><br>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>


            <br>

            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Followers</h5>
                    {% for following in profile.followed_by.all %}
                    {% if following.user.id != profile.user.id %}
                    <a href="{% url 'profile' following.user.id %}" class="card-link">@{{following|lower}}</a><br>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>

            <br>

            {% if profile.user.id != user.profile.user_id %}
            <form method="post">
                {% csrf_token %}
                {% if profile in user.profile.follows.all %}
                <button type="submit" class="btn btn-outline-danger" name="follow" value="unfollow">
                    Unfollow @{{profile.user.username|lower}}
                </button>

                {% else %}
                <button type="submit" class="btn btn-outline-success" name="follow" value="follow">
                    Follow @{{profile.user.username|lower}}
                </button>
                {% endif %}
            </form>
            {% endif %}

        </div>
    </div>
</div>

{% endif %}


{% endblock %}